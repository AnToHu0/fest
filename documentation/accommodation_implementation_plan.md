# План реализации модуля расселения

## 1. Подготовка моделей и типов

### Статусы размещения
```typescript
export enum PlacementStatus {
  BOOKED = 'booked',    // забронировано
  PAID = 'paid',        // оплачено
  SETTLED = 'settled',  // расселено
  SPECIAL = 'special'   // спец-гость
}
```

### Модель FestPlacement
Существующая модель уже содержит все необходимые поля:
- `id`, `roomId`, `slot`, `managerId`, `userId`
- `type` (будет использоваться для статуса)
- `datefrom`, `dateto`
- `comment`

## 2. Обновление меню
- Добавить пункт "Размещение" в `Sidebar.vue` после раздела регистрации
- Настроить проверку ролей (admin или accommodation_manager)

## 3. API эндпоинты

### Все эндпоинты реализуем по аналогии с уже имеющимися с точки зрения проверки прав и используемых подходов.

### GET /api/accommodation/rooms
- Получение списка комнат с их слотами
- Параметры фильтрации: корпус, этаж, номер
- Параметр `withPlacements=true` для получения текущих размещений

### GET /api/accommodation/placements
- Получение списка размещений с фильтрацией
- Фильтры: даты, статус, пользователь

### POST /api/accommodation/placements
- Создание нового размещения
- Валидация доступности слота

### PUT /api/accommodation/placements/:id
- Обновление статуса и других полей размещения

### DELETE /api/accommodation/placements/:id
- Удаление размещения

### GET /api/accommodation/users/:festivalId
- Получение списка зарегистрированных пользователей

### GET /api/accommodation/user/:userId/children
- Получение списка детей пользователя с фильтром по необходимости кровати

## 4. Компоненты интерфейса

### AccommodationLayout
Фильтры:
- Выбор корпуса
- Выбор этажа
- Поиск по номеру комнаты
- Поиск по имени пользователя
- Переключатель (все/занятые/свободные комнаты)
- Основная область с таймлайном

### TimelineGrid
- Шкала времени с датами фестиваля
- Сетка комнат, где каждая разбита на слоты
- Визуализация занятых периодов с разными цветами для разных статусов
- Иконка создания размещения при наведении на свободный слот

### PlacementForm
- Выбор пользователя с поиском среди зарегистрированных
- Выбор дат заезда/отъезда
- Выбор статуса размещения (booked/paid/settled/special)
- Поле для примечаний
- При выборе пользователя:
  - Проверка наличия детей, которым нужна кровать
  - Предложение разместить детей в той же комнате
  - Автоматическое заполнение дат для детей

## 5. Логика работы

### Валидация размещения
- Проверка пересечения дат в одном слоте
- Проверка наличия регистрации на фестиваль

### Отображение занятости комнат
- Разные цвета для разных статусов
- Отображение информации о размещении при наведении

### Управление размещением детей
- Предложение разместить детей после размещения взрослого
- Создание отдельных размещений для каждого ребенка

## 6. Оптимизация производительности
- Виртуализация списка комнат для большого количества данных
- Пагинация или "бесконечный скролл" для длинных списков
- Оптимизация запросов к API 