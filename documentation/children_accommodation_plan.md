# План реализации размещения детей

## 1. Создание новой модели FestPlacementChild

- [x] **Структура модели:**
  - [x] `id` - первичный ключ
  - [x] `placementId` - внешний ключ на FestPlacement (размещение родителя)
  - [x] `childId` - внешний ключ на FestRegistrationChild (ребенок из регистрации)

## 2. Модификация API-эндпоинтов

### 2.1. Создание нового эндпоинта для получения детей пользователя
- [x] Путь: `/api/accommodation/users/:userId/children`
- [x] Метод: GET
- [x] Функционал: Получение списка детей пользователя, зарегистрированных на текущий фестиваль
- [x] Возвращаемые данные: Массив детей с информацией о них и их регистрации на текущий фестиваль (имя, возраст, needSeparateBed)

### 2.2. Модификация эндпоинта создания размещения
- [x] Добавить обработку массива детей в запросе
- [x] Для детей с needSeparateBed=true создавать отдельные размещения 
- [x] Если в комнате родителя недостаточно кроватей для детей, то отменить транзакцию создания размещения и отправить на фронт сообщение "Недостаточно мест в комнате."
- [x] Для детей с needSeparateBed=false создавать записи в FestPlacementChild, привязанным к размещению родителя

### 2.3. Модификация эндпоинта получения размещений
- [x] Добавить включение связанных детей в ответ API
- [x] Включать информацию о детях, размещенных вместе с родителем

## 3. Модификация компонента PlacementFormModal

### 3.1. Добавление функционала загрузки детей
- [ ] При выборе пользователя отправлять запрос на получение его детей, зарегистрированных на этот фестиваль.
- [ ] Добавить состояние для хранения списка детей
- [ ] Добавить индикатор загрузки при запросе детей

### 3.2. Добавление UI для отображения детей
- [ ] Добавить секцию "Дети пользователя" в форму
- [ ] Для детей с needSeparateBed=true показывать чекбокс "автоматически разместить ребёнка в этой же комнате"
- [ ] Для детей с needSeparateBed=false показывать по-умолчанию установленный чекбокс "Разместить с родителем". В режиме редактирования должна быть возможность редактировать этот чекбокс и, соответственно создавать или удалять привязку FestPlacementChild

### 3.3. Модификация логики отправки формы
- [ ] Добавить обработку выбранных детей при отправке формы
- [ ] Для детей с needSeparateBed=true автоматически находить следующий доступный слот
- [ ] Проверять доступность слотов для размещения детей. Если в комнате родителя недостаточно кроватей для детей, бекенд вернёт ошибку и надо вывести её красным рядом с копкой сохранения. Сообщение должно затухнуть через 3 секунды.

## 4. Модификация компонента PlacementCard

### 4.1. Добавление отображения информации о детях
- [ ] Показывать список детей, размещенных вместе с родителем после имени родителя в формате "+n детей", при наведении на надпись о детях вылазит тултип с именами детей.

## 5. Модификация логики в accommodation.vue

### 5.1. Обновление handleSubmitPlacement
- [ ] Добавить обработку детей при создании/обновлении размещения
- [ ] Обновлять локальное состояние с учетом размещений детей
- [ ] Обрабатывать ошибки при размещении детей

### 5.2. Обновление handleDeletePlacement
- [ ] Добавить удаление связанных размещений детей, привязанных к месту родителя при удалении размещения родителя
- [ ] Обновлять локальное состояние с учетом удаленных размещений детей
